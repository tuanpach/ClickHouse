-- { echoOn }
select * from data_02572 order by key;
insert into data_02572 settings materialized_views_ignore_errors=1 values (2);
select * from data_02572 order by key;
2
-- check system.query_views_log
system flush logs query_views_log;
-- lower(status) to pass through clickhouse-test "exception" check
select lower(status::String), errorCodeToName(exception_code)
from system.query_views_log where
    view_name = concatWithSeparator('.', currentDatabase(), 'push_to_proxy_mv_02572') and
    view_target = concatWithSeparator('.', currentDatabase(), 'proxy_02572')
    order by event_date, event_time
;
exceptionwhileprocessing	UNKNOWN_TABLE
-- materialized_views_ignore_errors=0
insert into data_02572 values (1); -- { serverError UNKNOWN_TABLE }
-- Note: whether value 1 ends up in the source table after a failed INSERT is non-deterministic.
-- With `use_async_executor_for_materialized_views = 1`, the pipeline task scheduling order changes,
-- and the MV exception may cancel the pipeline before `MemorySink::onFinish` commits the data.
create table receiver_02572 as data_02572;
insert into data_02572 values (3);
select * from data_02572 where key in (2, 3) order by key;
2
3
select * from receiver_02572 order by key;
3
